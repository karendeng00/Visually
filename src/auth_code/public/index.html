<!doctype html>
<html>
  <head>
    <title>Spotify316</title>
  	<!-- meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	  
	<!-- local stylesheets -->
	<link rel="stylesheet" type="text/css" href="./styles.css">

    <!--  scripts for general website format-->  
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  	
    <!--   	bootstrap3 required for slider-->  
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
      
    <!--   	handlebars for templating-->   
	<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.4.2/handlebars.js"></script> 
	 <script src="./handlebars.js"></script> <!-- helper function here -->

	
	  <!-- Icons -->
	  <script src="https://kit.fontawesome.com/862904df26.js"></script>
	  
	  <!-- fullpage plugin docs -->
	  <link rel="stylesheet" type="text/css" href="./fullpage.css" />
	  <script type="text/javascript" src="./fullpage.js"></script>
	  <script type="text/javascript" src="./fullpage.extensions.min.js"></script>
	  <script type='text/javascript' rel='js/handlebars-v4.0.5.js'></script>

	  
  </head>

 <body>
	 <div id="login">
		 
		<nav id="menu" class="navbar navbar-default fixed-top">
		  <div class="container-fluid">
			  <div class="navbar-header">
				  <a class="navbar-brand" href="#firstPage">Logo</a>
			  </div>
			<ul class="nav navbar-nav navbar-right">
			  <li data-menuanchor="secondPage"><a href="#secondPage" style="color: white !important">Features</a></li>
			  <li data-menuanchor="thirdPage"><a href="#thirdPage" style="color: white !important">Our Team</a></li>
			  <li><a href="/login" style="color: white !important"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
			</ul>
		  </div>
		  
		   <button id="signin-button" onclick="signIn();" style="display: none;">Login</button>
  <div id="loading" style="display: none;">Signing in...</div>
  <button id="signout-button" onclick="signOut();" style="display: none;">Sign Out</button>
  <script>
    // Initialise Firebase
    const app = firebase.initializeApp(firebaseConfig);
    function login() {
      function getLoginURL(scopes) {
        return 'https://accounts.spotify.com/authorize?client_id=' + spotifyConfig.clientId +
          '&redirect_uri=' + encodeURIComponent(spotifyConfig.redirectUri) +
          '&scope=' + encodeURIComponent(scopes.join(' ')) +
          '&response_type=token';
      }
      const url = getLoginURL([
        'user-read-email'
      ]);
      return new Promise((resolve, reject) => {
        window.addEventListener('message', event => {
          const hash = JSON.parse(event.data);
          if (hash.type == 'access_token') {
            resolve(hash.access_token);
          }
        }, false);
        // Show spotify auth popup
        window.open(url, 'Spotify', 'height=600,width=400');
      });
    }
    function getUserData(accessToken) {
      return fetch(
        'https://api.spotify.com/v1/me',
        { 'headers': {'Authorization': 'Bearer ' + accessToken } }
      );
    }
    function signIn() {
      // Show loading text
      document.getElementById('loading').style.display = "block";
      // Hide buttons
      document.getElementById('signout-button').style.display = "none";
      document.getElementById('signin-button').style.display = "none";
      login()
        .then(accessToken => getUserData(accessToken))
        .then(response => response.json())
        .then(data => {
          // Call the signup function with the spotify id
          const signUp = firebase.functions().httpsCallable('signUp');
          return signUp({user_id: `spotify:${data.id}`})
        })
        .then(result => {
          // Sign in with the token from the function
          const token = result.data.token;
          return app.auth().signInWithCustomToken(token)
        }).then(user => {
          console.log("Logged in:", user);
        }).catch(error => {
          console.error(error);
        });
    }
  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      console.log("Authenticated:", user);
      // Show sign out button
      document.getElementById('signout-button').style.display = "block";
      document.getElementById('signin-button').style.display = "none";
      document.getElementById('loading').style.display = "none";
    } else {
      showLoginUI();
    }
  });
  function signOut() {
    firebase.auth().signOut().then(() => {
      showLoginUI();
    }).catch((error) => {
      console.error("Something bad happened");
    });
  }
  function showLoginUI() {
    // Show sign in button
    document.getElementById('signout-button').style.display = "none";
    document.getElementById('loading').style.display = "none";
    document.getElementById('signin-button').style.display = "block";
  }
  </script>
		</nav>	
		 
		 <div id="fullpage" style="top: 0px">			 
			 <div class="section full-width-color" id="full-page-1">
				 <div class="jumbotron text-center" style="background-color: transparent">
					 <h1>Spotify316</h1><br><br>
					 <p>Discover new music. Visualize your playlists. Connect with friends.</p><br>
					 <a href="/login" class="btn btn-lightred btn-primary btn-lg">Log in with Spotify</a><br><br><br><br>
				 </div>
			 </div>
			 <div class="section" id="full-page-2">
				<div class="container">
				  <div class="row">
					<div class="col-sm-4">
						<img src="https://via.placeholder.com/250">
					  <h3>Discover new music</h3>        
					  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
					  <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
					</div>
					<div class="col-sm-4">
					  <img src="https://via.placeholder.com/250">
					  <h3>Analyze your playlists</h3>
					  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
					  <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
					</div>
					<div class="col-sm-4">
					  <img src="https://via.placeholder.com/250">
					  <h3>Connect with friends</h3>
					  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
					  <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p>
					</div>
				  </div>
				</div>				 
			 </div>
			 <div class="section" id="full-page-3">
				 <div class="text-center">
					 <h2>Meet Our Team</h2><br><br><br>
				 </div>
				 <div class="container">
					<div class="row text-center">
					  <div class="col-sm-6"><img class="profile-img" src="https://via.placeholder.com/200"></div>
					  <div class="col-sm-4"><img class="profile-img" src="https://via.placeholder.com/200"></div>
					</div>
					<div class="row text-center">
					  <div class="col-sm-4"><img class="profile-img" src="https://via.placeholder.com/200"></div>
					  <div class="col-sm-4"><img class="profile-img" src="https://via.placeholder.com/200"></div>
					  <div class="col-sm-4"><img class="profile-img" src="https://via.placeholder.com/200"></div>
					</div>					 
				 </div>
			 </div>
		 </div>
	 </div>
	 
	 <div id="loggedin">

		<nav class="navbar navbar-default fixed-top">
		  <div class="container-fluid">
			<div class="navbar-header">
			  <a class="navbar-brand" href="#">LOGO</a>
			</div>
			<ul class="nav navbar-nav navbar-right">
			  <li><a href="./matches.html" style="color: white !important">Matches</a></li>
			  <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#" style="color: white !important">Analysis<span class="caret"></span></a>
				<ul class="dropdown-menu">
				  <li><a href="#" style="color: white !important">Page 1-1</a></li>
				  <li><a href="#" style="color: white !important">Page 1-2</a></li>
				  <li><a href="#" style="color: white !important">Page 1-3</a></li>
				</ul>
			  </li>
              <li><a href="#" style="color: white !important">Discover</a></li>
              <li class="active"><a href="#" style="color: white !important"><i class="fas fa-user" style="color: white"></i> Profile</a></li>
              <li><a href="#"><i class="fas fa-comment-dots" style="color: white"></i></a></li>
              <li><a href="#"><i class="fas fa-bell" style="color: white"></i></a></li>
			</ul>
		  </div>
		</nav> 
		 
		 <div class="container">
			 <div id="user-profile"></div>
			 <div id="topartists"></div>
			 <div id="oauth"></div>
			 <button class="btn btn-default" id="obtain-new-token">Obtain new token using the refresh token</button>
		 </div>
	 </div>
	 
	 <!-- full page jQeuery plugin -->
	 <script id="fullpage-jquery">
		 $(document).ready(function() {
			 $('#fullpage').fullpage({
				 //options here
				 autoScrolling:true,
				 scrollHorizontally: true,
				 anchors: ['firstPage', 'secondPage', 'thirdPage'],
				 menu: '#menu'
			 });
			 //methods
			 $.fn.fullpage.setAllowScrolling(true);
		 });
	 </script>
	 
      <script type="text/javascript" src="login.js"></script>
      <!-- The core Firebase JS SDK is always required and must be listed first -->
      <script src="/__/firebase/7.2.2/firebase-app.js"></script>

      <!-- TODO: Add SDKs for Firebase products that you want to use
          https://firebase.google.com/docs/web/setup#available-libraries -->
      <script src="/__/firebase/7.2.2/firebase-analytics.js"></script>
  
      <!-- Initialize Firebase -->
      <script src="/__/firebase/init.js"></script>

  </body>
</html>